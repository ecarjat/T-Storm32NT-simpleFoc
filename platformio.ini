; PlatformIO configuration for T-STorM32 NT Motor Module v2.51E running SimpleFOC
; Target MCU: STM32F103T8 (treated as generic STM32F103C8 Arduino core)

[env:tstorm32_simplefoc]  ; Application (linked at 0x08002000)
platform = ststm32
board = genericSTM32F103C8
framework = arduino
upload_protocol = stlink
monitor_speed = 115200
board_build.ldscript = ldscripts/app_offset.ld

; 8 MHz external resonator â†’ 72 MHz system clock via HSE
build_flags =
    -D HSE_VALUE=8000000U
    -D SIMPLEFOC_STM32_DEBUG=0
    -D VECT_TAB_OFFSET=0x2000
    -Wl,-z,max-page-size=0x200

; SimpleFOC core + Arduino-FOC-drivers (TLE5012B + streams)
lib_deps =
    https://github.com/simplefoc/Arduino-FOC
    https://github.com/simplefoc/Arduino-FOC-drivers

[env:tstorm32_simplefoc_debug]  ; Application with debug symbols (0x08002000)
platform = ststm32
board = genericSTM32F103C8
framework = arduino
upload_protocol = stlink
monitor_speed = 115200
board_build.ldscript = ldscripts/app_offset.ld
build_type = debug
build_flags =
    -D HSE_VALUE=8000000U
    -D SIMPLEFOC_STM32_DEBUG=0
    -D VECT_TAB_OFFSET=0x2000
    -Wl,-z,max-page-size=0x200
    -g -Og
lib_deps =
    https://github.com/simplefoc/Arduino-FOC
    https://github.com/simplefoc/Arduino-FOC-drivers

[env:tstorm32_bootloader] ; Minimal UART bootloader at 0x08000000 (8 KB target)
platform = ststm32
board = genericSTM32F103C8
framework = stm32cube
upload_protocol = stlink
; Only compile bootloader sources; exclude app
build_src_filter = -<*> +<../bootloader/src/**.c>
build_flags =
    -D HSE_VALUE=8000000U
    -D BOOTLOADER_BUILD
    -D APP_START_ADDR=0x08002000

[env:tstorm32_bootloader_debug] ; Minimal UART bootloader at 0x08000000 (8 KB target)
platform = ststm32
board = genericSTM32F103C8
framework = stm32cube
upload_protocol = stlink
; Only compile bootloader sources; exclude app
build_src_filter = -<*> +<../bootloader/src/**.c>
build_flags =
    -D HSE_VALUE=8000000U
    -D BOOTLOADER_BUILD
    -D APP_START_ADDR=0x08002000
    -g -Og